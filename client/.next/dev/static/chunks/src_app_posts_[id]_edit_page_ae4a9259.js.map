{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/React%20introduction/DEMOreact/react-ssr-blog/client/src/app/posts/%5Bid%5D/edit/page.js"],"sourcesContent":["'use client'; // 必须标记为客户端组件\r\n\r\nimport React, { useEffect, useState } from 'react';\r\nimport { Form, Input, Button, message, Card, Spin } from 'antd';\r\nimport axios from 'axios';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nconst { TextArea } = Input;\r\n\r\n// 动态路由页面\r\nexport default function EditPostPage({ params }) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [fetching, setFetching] = useState(true); // 初始加载数据的状态\r\n  const router = useRouter();\r\n  const [form] = Form.useForm();\r\n  const [postId, setPostId] = useState(''); // 存储文章ID\r\n\r\n\r\n  // 修正：正确解析路由参数 + 捕获错误\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        // 直接从 params 取 id（Next.js 客户端组件的 params 是普通对象）\r\n        const currentPostId = params.id;\r\n        if (!currentPostId) {\r\n          throw new Error('文章ID不存在');\r\n        }\r\n        setPostId(currentPostId);\r\n        await fetchPostData(currentPostId); // 调用获取文章数据的函数\r\n      } catch (error) {\r\n        message.error('加载编辑页失败：' + error.message);\r\n        // 可选：跳回首页（避免停留在错误页面）\r\n        // router.push('/');\r\n      } finally {\r\n        setFetching(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [params, router]); // 依赖 params（路由参数变化时重新加载）\r\n\r\n\r\n  // 1. 获取旧数据并回填表单\r\n  const fetchPostData = async (id) => {\r\n    try {\r\n      const res = await axios.get(`http://localhost:5000/api/posts/${id}`);\r\n      if (res.data.success) {\r\n        const { title, summary, content } = res.data.data;\r\n        form.setFieldsValue({ title, summary, content }); // 回填表单\r\n      } else {\r\n        throw new Error(res.data.message || '获取文章失败');\r\n      }\r\n    } catch (error) {\r\n      message.error('获取文章详情失败：' + error.message);\r\n    }\r\n  };\r\n\r\n\r\n  // 2. 提交更新\r\n  const onFinish = async (values) => {\r\n    if (!postId) {\r\n      return message.warning('文章ID无效');\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      await axios.put(`http://localhost:5000/api/posts/${postId}`, values);\r\n      message.success('修改成功！');\r\n      router.push(`/posts/${postId}`); // 跳转到文章详情页\r\n      router.refresh();\r\n    } catch (error) {\r\n      console.error(error);\r\n      message.error('修改失败：' + (error.response?.data?.message || error.message));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  // 加载中显示 Spin\r\n  if (fetching) {\r\n    return (\r\n      <div style={{ textAlign: 'center', marginTop: 100 }}>\r\n        <Spin size=\"large\" tip=\"加载原文中...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n\r\n  return (\r\n    <div style={{ maxWidth: '800px', margin: '50px auto', padding: '0 20px' }}>\r\n      <Card title=\"✏️ 编辑文章\" bordered={false} shadow=\"hover\">\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={onFinish}\r\n        >\r\n          <Form.Item label=\"文章标题\" name=\"title\" rules={[{ required: true, message: '请输入标题' }]}>\r\n            <Input size=\"large\" />\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"摘要\" name=\"summary\">\r\n            <Input />\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"文章内容\" name=\"content\" rules={[{ required: true, message: '请输入内容' }]}>\r\n            <TextArea rows={10} showCount maxLength={10000} />\r\n          </Form.Item>\r\n\r\n          <Form.Item>\r\n            <div style={{ display: 'flex', gap: 10 }}>\r\n              <Button type=\"primary\" htmlType=\"submit\" loading={loading} block size=\"large\">\r\n                保存修改\r\n              </Button>\r\n              <Button block size=\"large\" onClick={() => router.back()}>\r\n                取消\r\n              </Button>\r\n            </div>\r\n          </Form.Item>\r\n        </Form>\r\n      </Card>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}